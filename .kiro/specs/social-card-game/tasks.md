# 実装タスクリスト

## 完了済みタスク ✅

- [x] 1. Next.js 16プロジェクトのセットアップ
  - Next.js 16.0.0 プロジェクト作成（App Router + Turbopack）
  - TypeScript 5.7.2、ESLint、Prettier設定
  - Tailwind CSS 3.4.15 + shadcn/ui セットアップ
  - Drizzle ORM 0.36.4 + SQLite セットアップ
  - drizzle.config.ts 設定完了
  - Redis 4.7.0 クライアント設定
  - ディレクトリ構造作成完了
  - 共通型定義（types/index.ts）作成
  - _要件: 全体_

- [x] 2. Drizzleスキーマとデータベースの実装
  - [x] 2.1 Drizzleスキーマの作成
    - drizzle/schema.ts で全テーブル定義完了
    - SQLiteテーブル定義、リレーション、インデックス、制約設定完了
    - _要件: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 4.1, 8.1, 8.2, 11.1_
  - [x] 2.2 マイグレーションとシードデータ
    - drizzle/migrate.ts 作成
    - drizzle/seed.ts 作成（30種類以上のカードマスターデータ）
    - social-card-game.db 生成完了
    - _要件: 1.2, 2.1, 2.2, 3.2_
  - [x] 2.3 Drizzleクライアントのセットアップ
    - lib/db.ts でDrizzleクライアント作成完了
    - _要件: 1.2, 2.1_

- [x] 3. NextAuth.js v5認証システムの実装
  - [x] 3.1 NextAuth.js設定
    - auth.ts でNextAuth v5設定完了
    - Credentials Provider 設定完了
    - Drizzle Adapter 統合完了
    - _要件: 1.1_
  - [x] 3.2 認証APIエンドポイントの実装
    - app/api/auth/[...nextauth]/route.ts 実装完了
    - app/api/auth/register/route.ts 実装完了
    - app/api/auth/dev-login/route.ts 実装完了（開発用）
    - bcryptjs でパスワードハッシュ化実装完了
    - _要件: 1.1_
  - [x] 3.3 認証ミドルウェア
    - middleware.ts で保護ルート設定完了
    - _要件: 1.1_

- [x] 4. プレイヤーAPI Routesの実装
  - [x] 4.1 プレイヤープロフィール管理
    - app/api/player/profile/route.ts 完全実装（GET、PUT）
    - lib/services/player.service.ts でビジネスロジック実装完了
    - レベルと経験値の計算ロジック実装完了
    - スタミナ自動回復ロジック統合完了
    - _要件: 1.2, 1.3, 1.4_
  - [x] 4.2 通貨管理システム
    - lib/services/player.service.ts に通貨管理機能実装完了
    - updateGold、updateGems 関数実装完了
    - ゴールドとジェムの加算・減算ロジック実装完了
    - 残高検証機能実装完了（不足時エラー）
    - _要件: 9.1, 9.2, 9.5_
  - [x] 4.3 スタミナ管理システム
    - app/api/player/stamina/recover/route.ts 実装完了
    - lib/services/player.service.ts でスタミナ管理実装完了
    - 自動回復ロジック（5分で1ポイント）実装完了
    - スタミナ消費と検証機能実装完了
    - ジェム使用回復機能実装完了（10ジェム/1スタミナ）
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_
  - [x] 4.4 デイリーログインボーナス
    - app/api/player/daily-login/route.ts 完全実装（GET、POST）
    - 連続ログイン日数の追跡ロジック実装完了
    - 報酬配布システム実装完了（ゴールド、ジェム）
    - 7日目特別報酬実装完了
    - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_

- [x] 5. カードシステムの実装
  - [x] 5.1 カードマスターデータの管理
    - app/api/cards/master/route.ts 実装完了
    - lib/services/card.service.ts 実装完了
    - drizzle/seed.ts でカードマスターデータ充実（30種類以上）
    - 6属性（火、水、地、風、光、闇）実装完了
    - 4レアリティ（Common、Rare、Super Rare、Ultra Rare）実装完了
    - _要件: 2.1_
  - [x] 5.2 プレイヤーカードコレクションの実装
    - app/api/cards/collection/route.ts 実装完了
    - カード所有権の検証機能実装完了
    - カードマスターデータとのJOIN実装完了
    - _要件: 2.2, 2.3_
  - [x] 5.3 カード強化システムの実装
    - app/api/cards/enhance/route.ts 実装完了
    - レベルアップ計算ロジック実装完了
    - ステータス向上の計算式実装完了（レベル毎に+2）
    - 素材カードの消費処理実装完了
    - ゴールドコスト処理実装完了
    - 経験値計算実装完了（素材レベル × 50）
    - _要件: 2.4, 2.5_

- [x] 6. デッキ管理システムの実装
  - [x] 6.1 デッキCRUD操作の実装
    - app/api/decks/route.ts 完全実装（GET、POST）
    - app/api/decks/[deckId]/route.ts 完全実装（GET、PUT、DELETE）
    - lib/services/deck.service.ts 実装完了
    - _要件: 3.1_
  - [x] 6.2 デッキバリデーションの実装
    - カード枚数制限（20-40枚）の検証実装完了
    - 同一カード制限（最大3枚）の検証実装完了
    - 総コスト制限（200）の検証実装完了
    - カード所有権の検証実装完了
    - _要件: 3.2, 3.3, 3.4, 3.5_

- [x] 7. ガチャシステムの実装
  - [x] 7.1 ガチャバナー管理の実装
    - app/api/gacha/banners/route.ts 実装完了
    - lib/services/gacha.service.ts 実装完了
    - バナーの有効期限チェック機能実装完了
    - _要件: 4.1_
  - [x] 7.2 ガチャ抽選ロジックの実装
    - 確率テーブル実装完了（Common 70%、Rare 20%、SR 8%、UR 2%）
    - 単発ガチャ実装完了
    - 10連ガチャ実装完了（Rare以上1枚保証）
    - レートアップカード優先抽選実装完了（50%確率）
    - _要件: 4.2, 4.3, 4.4_
  - [x] 7.3 ガチャ実行処理の実装
    - app/api/gacha/pull/route.ts 実装完了
    - 通貨消費処理実装完了（ゴールド/ジェム対応）
    - カードをプレイヤーコレクションに追加実装完了
    - ガチャ履歴の記録実装完了
    - app/api/gacha/history/route.ts 実装完了
    - _要件: 4.5, 4.6_

- [x] 8. クエストシステムの実装
  - [x] 8.1 クエストデータ管理の実装
    - app/api/quests/route.ts 実装完了
    - app/api/quests/[questId]/route.ts 実装完了
    - lib/services/quest.service.ts 実装完了
    - クエストマスターデータのシード実装完了
    - _要件: 7.1_
  - [x] 8.2 クエスト実行処理の実装
    - app/api/quests/[questId]/start/route.ts 実装完了
    - スタミナ消費処理実装完了
    - プレイヤーレベルチェック実装完了
    - クエスト進行状況の記録実装完了
    - _要件: 7.2, 7.3_
  - [x] 8.3 クエスト完了と報酬配布の実装
    - app/api/quests/[questId]/complete/route.ts 実装完了
    - 初回クリア判定実装完了
    - 報酬配布処理実装完了（経験値、ゴールド、ジェム、カード、スタミナ）
    - クエスト進行状況の更新実装完了
    - _要件: 7.4, 7.5_

- [x] 9. ソーシャル機能の実装
  - [x] 9.1 フレンド管理の実装
    - app/api/friends/route.ts 実装完了（GET）
    - app/api/friends/request/route.ts 実装完了（POST）
    - app/api/friends/accept/route.ts 実装完了（POST）
    - app/api/friends/reject/route.ts 実装完了（POST）
    - app/api/friends/[friendshipId]/route.ts 実装完了（DELETE）
    - app/api/friends/search/route.ts 実装完了（GET）
    - app/api/friends/requests/route.ts 実装完了（GET）
    - app/api/social/friends/route.ts 実装完了（GET）
    - app/api/social/friends/request/route.ts 実装完了（POST）
    - app/api/social/friends/accept/route.ts 実装完了（POST）
    - app/api/social/friends/[friendId]/route.ts 実装完了（DELETE）
    - lib/services/friends.service.ts 実装完了
    - 双方向フレンドシップ実装完了
    - フレンド検索機能実装完了（ユーザー名）
    - _要件: 8.1, 8.2, 8.3_
  - [x] 9.2 ランキングシステムの実装
    - app/api/ranking/route.ts 実装完了（GET）
    - app/api/ranking/my-rank/route.ts 実装完了（GET）
    - app/api/social/ranking/route.ts 実装完了（GET）
    - lib/services/ranking.service.ts 実装完了
    - レベルランキング実装完了
    - パワーランキング実装完了
    - 勝利数ランキング実装完了
    - 勝率ランキング実装完了
    - プレイヤー順位取得実装完了
    - _要件: 11.1, 11.2, 11.3, 11.4, 11.5_

- [x] 10. E2Eテスト基盤の構築
  - [x] 10.1 Playwright環境のセットアップ
    - playwright.config.ts 設定完了
    - tests/e2e ディレクトリ構造作成完了
    - _要件: 全体_
  - [x] 10.2 基本的なE2Eテストの実装
    - tests/e2e/dev-login.spec.ts 実装完了
    - tests/e2e/gacha.spec.ts 実装完了
    - tests/e2e/player-content.spec.ts 実装完了
    - tests/e2e/utils/auth.ts ヘルパー実装完了
    - _要件: 全体_

## 未実装タスク ⏳

- [ ] 11. バトルシステムの実装
  - [ ] 11.1 バトル初期化の実装
    - app/api/battle/start/route.ts を作成
    - lib/services/battle.service.ts を作成
    - デッキのシャッフルと初期手札配布を実装
    - バトル状態の初期化を実装
    - battlesテーブルへの記録を実装
    - _要件: 6.1, 6.5_
  - [ ] 11.2 ターン処理ロジックの実装
    - カードドロー機能を実装
    - コスト回復機能を実装（毎ターン+1、最大10）
    - ターン開始フェーズの処理を実装
    - _要件: 6.2, 6.3_
  - [ ] 11.3 カードプレイとアクション処理の実装
    - app/api/battle/[battleId]/action/route.ts を作成
    - カードプレイのバリデーションを実装
    - 攻撃処理とダメージ計算を実装
    - カード効果の適用を実装
    - _要件: 6.4, 6.5_
  - [ ] 11.4 勝敗判定と報酬システムの実装
    - ライフポイントチェックを実装
    - バトル終了処理を実装
    - 報酬計算と配布を実装
    - app/api/battle/[battleId]/state/route.ts を作成
    - プレイヤーの勝敗記録を更新
    - _要件: 6.6, 6.7_
  - [ ]* 11.5 バトルシステムのテスト
    - ターン処理のテストを作成
    - ダメージ計算のテストを作成
    - 勝敗判定のテストを作成
    - _要件: 6.2, 6.5, 6.6_

- [ ] 12. Web通知システムの実装
  - [ ] 12.1 通知データモデルの作成
    - drizzle/schema.ts に notifications テーブルを追加
    - 通知タイプ（スタミナ、フレンド申請、イベント）の定義
    - _要件: 12.2, 12.5_
  - [ ] 12.2 通知管理APIの実装
    - app/api/notifications/route.ts を作成（GET、POST）
    - app/api/notifications/[id]/read/route.ts を作成
    - lib/services/notification.service.ts を作成
    - アプリ内通知の保存と取得機能を実装
    - 未読通知カウント機能を実装
    - _要件: 12.2, 12.5_
  - [ ] 12.3 ブラウザ通知の実装
    - Web Notifications API の統合
    - 通知許可リクエストUIを実装
    - スタミナ満タン通知のポーリング/WebSocketを実装
    - イベント開始通知の送信機能を実装
    - Sonner でトースト通知を実装（既にインストール済み）
    - 通知設定のカスタマイズ機能を実装
    - _要件: 12.1, 12.3, 12.4_
  - [ ]* 12.4 通知システムのテスト
    - 通知送信のテストを作成
    - _要件: 12.1, 12.2_

- [ ] 13. フロントエンド - 認証ページ
  - [ ] 13.1 ログインページの実装
    - app/login/page.tsx を完全実装
    - React Hook Form + Zod でフォームバリデーション
    - NextAuth signIn 関数との連携
    - エラーメッセージ表示
    - _要件: 1.1_
  - [ ] 13.2 新規登録ページの実装
    - app/(auth)/register/page.tsx を完全実装
    - フォームバリデーションとエラー表示
    - 登録API呼び出しと自動ログイン
    - _要件: 1.1_

- [ ] 14. フロントエンド - プレイヤーとカード管理
  - [ ] 14.1 ホームページの実装
    - app/home/page.tsx を完全実装
    - ヘッダー: プレイヤー情報、通貨、スタミナ（リアルタイム更新）
    - メインメニュー: クエスト、ガチャ、デッキ、カード、フレンド、ランキング
    - デイリーログインボーナスモーダル
    - 通知バッジ表示
    - SWRでデータフェッチ
    - _要件: 1.2, 5.1, 5.2, 10.1_
  - [ ] 14.2 プロフィールページの実装
    - app/(game)/profile/page.tsx を作成
    - SWRでプロフィールデータをフェッチ
    - プロフィール編集フォームを実装
    - レベルと経験値のプログレスバー表示
    - _要件: 1.2, 1.3_
  - [ ] 14.3 カードコレクションページの実装
    - app/cards/page.tsx を完全実装
    - カードグリッド表示コンポーネント
    - フィルタリング（レアリティ、属性）とソート機能
    - カード詳細モーダルを実装
    - _要件: 2.2, 2.3_
  - [ ] 14.4 カード強化ページの実装
    - app/(game)/cards/[id]/enhance/page.tsx を作成
    - 素材カード選択UI（ドラッグ&ドロップまたはクリック選択）
    - 強化プレビューと確認ダイアログ
    - Framer Motionで強化アニメーション
    - _要件: 2.4, 2.5_

- [ ] 15. フロントエンド - デッキ構築
  - [ ] 15.1 デッキ一覧ページの実装
    - app/decks/page.tsx を完全実装
    - デッキカード表示（サムネイル、カード枚数、総コスト）
    - デッキ選択、削除、新規作成ボタン
    - _要件: 3.1_
  - [ ] 15.2 デッキ編集ページの実装
    - app/(game)/deck/[id]/edit/page.tsx を作成
    - 左側: 所有カード一覧、右側: デッキ内カード
    - dnd-kit でドラッグ&ドロップ機能を実装（既にインストール済み）
    - リアルタイムバリデーション（枚数、コスト、重複制限）
    - _要件: 3.2, 3.3, 3.4, 3.5_

- [ ] 16. フロントエンド - ガチャ
  - [ ] 16.1 ガチャページの実装
    - app/gacha/page.tsx を完全実装
    - バナーカルーセル表示
    - 単発・10連ガチャボタンと通貨表示
    - Framer Motionでガチャ演出アニメーション（カードめくり）
    - 結果表示モーダル（獲得カード一覧）
    - _要件: 4.1, 4.2, 4.6_
  - [ ] 16.2 ガチャ履歴ページの実装
    - app/(game)/gacha/history/page.tsx を作成
    - 履歴一覧表示（日時、獲得カード）
    - _要件: 4.6_

- [ ] 17. フロントエンド - クエストとバトル
  - [ ] 17.1 クエストページの実装
    - app/quests/page.tsx を完全実装
    - クエストカード一覧（難易度別タブ）
    - 各クエスト: 名前、難易度、スタミナコスト、報酬プレビュー
    - クエスト開始ボタン → デッキ選択 → バトル開始
    - _要件: 7.1, 7.2_
  - [ ] 17.2 バトルページの実装
    - app/(game)/battle/[id]/page.tsx を作成
    - バトルフィールドレイアウト（上: 相手、下: 自分）
    - 手札表示とカードプレイUI
    - ライフポイント、コスト、ターン表示
    - Zustandでバトル状態管理
    - _要件: 6.1, 6.4_
  - [ ] 17.3 バトルアニメーションの実装
    - Framer Motionでカードプレイアニメーション
    - 攻撃エフェクト（パーティクル、フラッシュ）
    - ダメージ数値のポップアップアニメーション
    - _要件: 6.5_
  - [ ] 17.4 バトル結果モーダルの実装
    - 勝敗表示（Victory/Defeat）
    - 獲得報酬の表示（経験値、通貨、カード）
    - ホームに戻るボタン
    - _要件: 6.7_

- [ ] 18. フロントエンド - ソーシャル機能
  - [ ] 18.1 フレンドページの実装
    - app/friends/page.tsx を完全実装
    - タブ: フレンド一覧、フレンド申請、検索
    - フレンドカード表示（アイコン、名前、レベル、最終ログイン）
    - フレンド検索（ユーザー名）
    - 申請送信・承認・削除ボタン
    - _要件: 8.1, 8.2_
  - [ ] 18.2 ランキングページの実装
    - app/ranking/page.tsx を完全実装
    - タブ: レベルランキング、パワーランキング、勝利数ランキング、勝率ランキング
    - ランキングテーブル（順位、プレイヤー名、スコア）
    - 自分の順位をハイライト表示
    - _要件: 11.4, 11.5_

- [ ] 19. システム統合とポリッシュ
  - [ ] 19.1 共通UIコンポーネントの実装
    - components/ui に shadcn/ui コンポーネントを追加
    - components/game に共通ゲームコンポーネントを実装
    - カードコンポーネント（表示、ホバー効果）
    - プログレスバーコンポーネント
    - モーダルコンポーネント
    - _要件: 全体_
  - [ ] 19.2 エラーハンドリングの統合
    - グローバルエラーハンドラーを実装
    - ユーザーフレンドリーなエラーメッセージを実装
    - ネットワークエラーのリトライ機能を実装
    - components/ErrorBoundary.tsx の活用
    - _要件: 全体_
  - [ ] 19.3 ローディング状態の実装
    - 全画面にローディングインジケーターを追加
    - スケルトンスクリーンを実装
    - SWRのローディング状態を活用
    - _要件: 全体_
  - [ ] 19.4 パフォーマンス最適化
    - 画像の遅延読み込みを実装
    - リスト仮想化を実装
    - APIレスポンスのキャッシュを実装（SWR活用）
    - Next.js 16の新機能活用（cacheLife、after API）
    - _要件: 全体_
  - [ ]* 19.5 包括的なE2Eテストの作成
    - カード強化フローのテスト
    - デッキ編集フローのテスト
    - クエスト完了フローのテスト
    - フレンド管理フローのテスト
    - _要件: 全体_

- [ ] 20. デプロイメントとドキュメント
  - [ ] 20.1 環境設定の整備
    - 開発、ステージング、本番環境の設定ファイルを作成
    - 環境変数の管理を実装
    - PostgreSQL移行準備（本番環境用）
    - _要件: 全体_
  - [ ] 20.2 CI/CDパイプラインの構築
    - GitHub ActionsまたはGitLab CIの設定を作成
    - 自動テストとビルドを設定
    - 自動デプロイメント設定
    - _要件: 全体_
  - [ ]* 20.3 APIドキュメントの作成
    - Swagger/OpenAPI仕様書を作成
    - 既存APIエンドポイントのドキュメント化
    - _要件: 全体_
  - [ ] 20.4 READMEとセットアップガイドの更新
    - プロジェクトのREADMEを更新（既存あり、実装状況を反映）
    - 開発環境セットアップガイドを更新
    - デプロイメントガイドを作成
    - トラブルシューティングガイドを作成
    - _要件: 全体_
