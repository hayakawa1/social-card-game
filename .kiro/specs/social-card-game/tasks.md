# 実装タスクリスト

## 完了済みタスク ✅

- [x] 1. Next.js 16プロジェクトのセットアップ
  - Next.js 16.0.0 プロジェクト作成（App Router + Turbopack）
  - TypeScript 5.7.2、ESLint、Prettier設定
  - Tailwind CSS 3.4.15 + shadcn/ui セットアップ
  - Drizzle ORM 0.36.4 + SQLite セットアップ
  - drizzle.config.ts 設定完了
  - Redis 4.7.0 クライアント設定
  - ディレクトリ構造作成完了
  - 共通型定義（types/index.ts）作成
  - _要件: 全体_

- [x] 2. Drizzleスキーマとデータベースの実装
  - [x] 2.1 Drizzleスキーマの作成
    - drizzle/schema.ts で全テーブル定義完了
    - SQLiteテーブル定義、リレーション、インデックス、制約設定完了
    - _要件: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 4.1, 8.1, 8.2, 11.1_
  - [x] 2.2 マイグレーションとシードデータ
    - drizzle/migrate.ts 作成
    - drizzle/seed.ts 作成
    - social-card-game.db 生成完了
    - _要件: 1.2, 2.1, 2.2, 3.2_
  - [x] 2.3 Drizzleクライアントのセットアップ
    - lib/db.ts でDrizzleクライアント作成完了
    - _要件: 1.2, 2.1_

- [x] 3. NextAuth.js v5認証システムの実装
  - [x] 3.1 NextAuth.js設定
    - auth.ts でNextAuth v5設定完了
    - Credentials Provider 設定完了
    - Drizzle Adapter 統合完了
    - _要件: 1.1_
  - [x] 3.2 認証APIエンドポイントの実装
    - app/api/auth/[...nextauth]/route.ts 実装完了
    - app/api/auth/register/route.ts 実装完了
    - app/api/auth/dev-login/route.ts 実装完了（開発用）
    - bcryptjs でパスワードハッシュ化実装完了
    - _要件: 1.1_
  - [x] 3.3 認証ミドルウェア
    - middleware.ts で保護ルート設定完了
    - _要件: 1.1_

## 実装中タスク 🚧

- [ ] 4. プレイヤーAPI Routesの実装
  - [ ] 4.1 プレイヤープロフィール管理
    - app/api/player/profile/route.ts の完全実装（GET、PUT）
    - lib/services/player.service.ts でビジネスロジックを実装
    - レベルと経験値の計算ロジックを実装
    - _要件: 1.2, 1.3, 1.4_
  - [ ] 4.2 通貨管理システム
    - lib/services/currency.service.ts を実装
    - ゴールドとジェムの加算・減算ロジック
    - Drizzleトランザクション処理を実装
    - 残高検証機能を実装
    - _要件: 9.1, 9.2, 9.5_
  - [ ] 4.3 スタミナ管理システム
    - app/api/player/stamina/route.ts の完全実装
    - lib/services/stamina.service.ts で自動回復ロジック（5分で1ポイント）を実装
    - スタミナ消費と検証機能を実装
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_
  - [ ] 4.4 デイリーログインボーナス
    - app/api/player/daily-login/route.ts の完全実装（GET、POST）
    - 連続ログイン日数の追跡ロジックを実装
    - 報酬配布システムを実装
    - _要件: 10.1, 10.2, 10.3, 10.4, 10.5_
  - [ ] 4.5 プレイヤーサービスのテスト
    - API Routesの統合テストを作成
    - ビジネスロジックのユニットテストを作成
    - _要件: 1.2, 5.2, 9.5_

- [ ] 5. カードシステムの実装
  - [ ] 5.1 カードマスターデータの管理
    - app/api/cards/master/route.ts の完全実装
    - drizzle/seed.ts でカードマスターデータを充実（現在30種類以上に拡張）
    - Redisキャッシュ機能を実装
    - _要件: 2.1_
  - [ ] 5.2 プレイヤーカードコレクションの実装
    - app/api/cards/collection/route.ts の完全実装
    - カード所有権の検証機能を実装
    - _要件: 2.2, 2.3_
  - [ ] 5.3 カード強化システムの実装
    - app/api/cards/enhance/route.ts の完全実装
    - レベルアップ計算ロジックを実装
    - ステータス向上の計算式を実装
    - 素材カードの消費処理を実装
    - _要件: 2.4, 2.5_
  - [ ] 5.4 カードシステムのテスト
    - カード強化ロジックのテストを作成
    - _要件: 2.5_

- [ ] 6. デッキ管理システムの実装
  - [ ] 6.1 デッキCRUD操作の実装
    - app/api/decks/route.ts の完全実装（GET、POST）
    - app/api/decks/[deckId]/route.ts の完全実装（PUT、DELETE）
    - _要件: 3.1_
  - [ ] 6.2 デッキバリデーションの実装
    - カード枚数制限（20-40枚）の検証を実装
    - 同一カード制限（最大3枚）の検証を実装
    - 総コスト制限の検証を実装
    - カード所有権の検証を実装
    - _要件: 3.2, 3.3, 3.4, 3.5_
  - [ ] 6.3 デッキ管理のテスト
    - デッキバリデーションのテストを作成
    - _要件: 3.2, 3.3, 3.4_

- [ ] 7. ガチャシステムの実装
  - [ ] 7.1 ガチャバナー管理の実装
    - GET /api/gacha/banners エンドポイントを実装
    - バナーの有効期限チェック機能を実装
    - _要件: 4.1_
  - [ ] 7.2 ガチャ抽選ロジックの実装
    - 確率テーブルに基づくカード抽選機能を実装
    - 単発ガチャの実装
    - 10連ガチャの実装（Rare以上1枚保証）
    - POST /api/gacha/pull エンドポイントを実装
    - _要件: 4.2, 4.3, 4.4_
  - [ ] 7.3 ガチャ実行処理の実装
    - 通貨消費処理を実装
    - カードをプレイヤーコレクションに追加
    - ガチャ履歴の記録
    - GET /api/gacha/history エンドポイントを実装
    - _要件: 4.5, 4.6_
  - [ ] 7.4 ガチャシステムのテスト
    - 確率分布のテストを作成
    - 10連保証ロジックのテストを作成
    - _要件: 4.3, 4.4_

- [ ] 8. バトルシステムの実装（未実装）
  - [ ] 8.1 バトル初期化の実装
    - app/api/battle/start/route.ts を作成
    - デッキのシャッフルと初期手札配布を実装
    - バトル状態の初期化を実装
    - _要件: 6.1, 6.5_
  - [ ] 8.2 ターン処理ロジックの実装
    - カードドロー機能を実装
    - コスト回復機能を実装
    - ターン開始フェーズの処理を実装
    - _要件: 6.2, 6.3_
  - [ ] 8.3 カードプレイとアクション処理の実装
    - app/api/battle/[battleId]/action/route.ts を作成
    - カードプレイのバリデーションを実装
    - 攻撃処理とダメージ計算を実装
    - カード効果の適用を実装
    - _要件: 6.4, 6.5_
  - [ ] 8.4 勝敗判定と報酬システムの実装
    - ライフポイントチェックを実装
    - バトル終了処理を実装
    - 報酬計算と配布を実装
    - app/api/battle/[battleId]/state/route.ts を作成
    - _要件: 6.6, 6.7_
  - [ ] 8.5 バトルシステムのテスト
    - ターン処理のテストを作成
    - ダメージ計算のテストを作成
    - 勝敗判定のテストを作成
    - _要件: 6.2, 6.5, 6.6_

- [ ] 9. クエストシステムの実装
  - [ ] 9.1 クエストデータ管理の実装
    - GET /api/quests エンドポイントを実装
    - GET /api/quests/:questId エンドポイントを実装
    - クエストマスターデータのシードファイルを作成
    - _要件: 7.1_
  - [ ] 9.2 クエスト実行処理の実装
    - POST /api/quests/:questId/start エンドポイントを実装
    - スタミナ消費処理を実装
    - プレイヤーレベルチェックを実装
    - AIデッキとのバトル開始を実装
    - _要件: 7.2, 7.3_
  - [ ] 9.3 クエスト完了と報酬配布の実装
    - POST /api/quests/:questId/complete エンドポイントを実装
    - 初回クリア判定を実装
    - 報酬配布処理を実装
    - クエスト進行状況の記録を実装
    - _要件: 7.4, 7.5_
  - [ ] 9.4 クエストシステムのテスト
    - クエスト開始条件のテストを作成
    - 報酬配布のテストを作成
    - _要件: 7.2, 7.4_

- [ ] 10. ソーシャル機能の実装
  - [ ] 10.1 フレンド管理の実装
    - app/api/friends/route.ts の完全実装（GET）
    - app/api/friends/request/route.ts の完全実装（POST）
    - app/api/friends/accept/route.ts の完全実装（POST）
    - app/api/friends/reject/route.ts の完全実装（POST）
    - app/api/friends/[friendshipId]/route.ts の完全実装（DELETE）
    - app/api/friends/search/route.ts の完全実装（GET）
    - フレンド数制限（最大50人）の検証を実装
    - _要件: 8.1, 8.2, 8.3_
  - [ ] 10.2 サポートカードシステムの実装
    - app/api/social/support/use/route.ts を作成
    - 友情ポイント付与機能を実装
    - _要件: 8.4, 8.5_
  - [ ] 10.3 ランキングシステムの実装
    - app/api/ranking/route.ts の完全実装（GET）
    - app/api/ranking/my-rank/route.ts の完全実装（GET）
    - ランキングポイント計算ロジックを実装
    - ランキング更新処理を実装
    - シーズン終了と報酬配布を実装
    - _要件: 11.1, 11.2, 11.3, 11.4, 11.5, 11.6_
  - [ ] 10.4 ソーシャル機能のテスト
    - フレンド申請と承認のテストを作成
    - ランキング計算のテストを作成
    - _要件: 8.2, 11.2, 11.3_

- [ ] 11. Web通知システムの実装
  - [ ] 11.1 通知管理の実装
    - 通知データモデルを作成
    - アプリ内通知の保存と取得機能を実装
    - 未読通知カウント機能を実装
    - _要件: 12.2, 12.5_
  - [ ] 11.2 ブラウザ通知の実装
    - Web Notifications API の統合
    - 通知許可リクエストUIを実装
    - スタミナ満タン通知のポーリング/WebSocketを実装
    - イベント開始通知の送信機能を実装
    - React Hot Toast または Sonner でトースト通知を実装
    - 通知設定のカスタマイズ機能を実装
    - _要件: 12.1, 12.3, 12.4_
  - [ ] 11.3 通知システムのテスト
    - 通知送信のテストを作成
    - _要件: 12.1, 12.2_

- [ ] 12. フロントエンド - 認証ページ
  - [ ] 12.1 ログインページの実装
    - app/(auth)/login/page.tsx を作成
    - React Hook Form + Zod でフォームバリデーション
    - NextAuth signIn 関数との連携
    - _要件: 1.1_
  - [ ] 12.2 新規登録ページの実装
    - app/(auth)/register/page.tsx を作成
    - フォームバリデーションとエラー表示
    - 登録API呼び出しと自動ログイン
    - _要件: 1.1_

- [ ] 13. フロントエンド - プレイヤーとカード管理
  - [ ] 13.1 プロフィールページの実装
    - app/(game)/profile/page.tsx を作成
    - SWRでプロフィールデータをフェッチ
    - プロフィール編集フォームを実装
    - レベルと経験値のプログレスバー表示
    - _要件: 1.2, 1.3_
  - [ ] 13.2 カードコレクションページの実装
    - app/(game)/cards/page.tsx を作成
    - カードグリッド表示コンポーネント
    - フィルタリング（レアリティ、属性）とソート機能
    - カード詳細モーダルを実装
    - _要件: 2.2, 2.3_
  - [ ] 13.3 カード強化ページの実装
    - app/(game)/cards/[id]/enhance/page.tsx を作成
    - 素材カード選択UI（ドラッグ&ドロップまたはクリック選択）
    - 強化プレビューと確認ダイアログ
    - Framer Motionで強化アニメーション
    - _要件: 2.4, 2.5_

- [ ] 14. フロントエンド - デッキ構築
  - [ ] 14.1 デッキ一覧ページの実装
    - app/(game)/deck/page.tsx を作成
    - デッキカード表示（サムネイル、カード枚数、総コスト）
    - デッキ選択、削除、新規作成ボタン
    - _要件: 3.1_
  - [ ] 14.2 デッキ編集ページの実装
    - app/(game)/deck/[id]/edit/page.tsx を作成
    - 左側: 所有カード一覧、右側: デッキ内カード
    - dnd-kit でドラッグ&ドロップ機能を実装
    - リアルタイムバリデーション（枚数、コスト、重複制限）
    - _要件: 3.2, 3.3, 3.4, 3.5_

- [ ] 15. フロントエンド - ガチャ
  - [ ] 15.1 ガチャページの実装
    - app/(game)/gacha/page.tsx を作成
    - バナーカルーセル表示
    - 単発・10連ガチャボタンと通貨表示
    - Framer Motionでガチャ演出アニメーション（カードめくり）
    - 結果表示モーダル（獲得カード一覧）
    - _要件: 4.1, 4.2, 4.6_
  - [ ] 15.2 ガチャ履歴ページの実装
    - app/(game)/gacha/history/page.tsx を作成
    - 履歴一覧表示（日時、獲得カード）
    - _要件: 4.6_

- [ ] 16. フロントエンド - バトル
  - [ ] 16.1 バトルページの実装
    - app/(game)/battle/[id]/page.tsx を作成
    - バトルフィールドレイアウト（上: 相手、下: 自分）
    - 手札表示とカードプレイUI
    - ライフポイント、コスト、ターン表示
    - Zustandでバトル状態管理
    - _要件: 6.1, 6.4_
  - [ ] 16.2 バトルアニメーションの実装
    - Framer Motionでカードプレイアニメーション
    - 攻撃エフェクト（パーティクル、フラッシュ）
    - ダメージ数値のポップアップアニメーション
    - _要件: 6.5_
  - [ ] 16.3 バトル結果モーダルの実装
    - 勝敗表示（Victory/Defeat）
    - 獲得報酬の表示（経験値、通貨、カード）
    - ホームに戻るボタン
    - _要件: 6.7_

- [ ] 17. フロントエンド - ホームとクエスト
  - [ ] 17.1 ホームページの実装
    - app/(game)/home/page.tsx を作成
    - ヘッダー: プレイヤー情報、通貨、スタミナ（リアルタイム更新）
    - メインメニュー: クエスト、ガチャ、デッキ、カード、フレンド、ランキング
    - デイリーログインボーナスモーダル
    - 通知バッジ表示
    - _要件: 5.1, 5.2, 10.1, 12.5_
  - [ ] 17.2 クエストページの実装
    - app/(game)/quest/page.tsx を作成
    - クエストカード一覧（難易度別タブ）
    - 各クエスト: 名前、難易度、スタミナコスト、報酬プレビュー
    - クエスト開始ボタン → デッキ選択 → バトル開始
    - _要件: 7.1, 7.2_

- [ ] 18. フロントエンド - ソーシャル機能
  - [ ] 18.1 フレンドページの実装
    - app/(game)/friends/page.tsx を作成
    - タブ: フレンド一覧、フレンド申請、検索
    - フレンドカード表示（アイコン、名前、レベル、最終ログイン）
    - フレンド検索（プレイヤーID or 名前）
    - 申請送信・承認・削除ボタン
    - _要件: 8.1, 8.2_
  - [ ] 18.2 ランキングページの実装
    - app/(game)/ranking/page.tsx を作成
    - タブ: PvPランキング、レベルランキング
    - ランキングテーブル（順位、プレイヤー名、スコア）
    - 自分の順位をハイライト表示
    - _要件: 11.4, 11.5_

- [ ] 19. システム統合とポリッシュ
  - [ ] 19.1 エラーハンドリングの統合
    - グローバルエラーハンドラーを実装
    - ユーザーフレンドリーなエラーメッセージを実装
    - ネットワークエラーのリトライ機能を実装
    - _要件: 全体_
  - [ ] 19.2 ローディング状態の実装
    - 全画面にローディングインジケーターを追加
    - スケルトンスクリーンを実装
    - _要件: 全体_
  - [ ] 19.3 パフォーマンス最適化
    - 画像の遅延読み込みを実装
    - リスト仮想化を実装
    - APIレスポンスのキャッシュを実装
    - _要件: 全体_
  - [ ] 19.4 E2Eテストの作成
    - 主要ユーザーフローのE2Eテストを作成
    - _要件: 全体_

- [ ] 20. デプロイメントとドキュメント
  - [ ] 20.1 環境設定の整備
    - 開発、ステージング、本番環境の設定ファイルを作成
    - 環境変数の管理を実装
    - _要件: 全体_
  - [ ] 20.2 CI/CDパイプラインの構築
    - GitHub ActionsまたはGitLab CIの設定を作成
    - 自動テストとビルドを設定
    - _要件: 全体_
  - [ ] 20.3 APIドキュメントの作成
    - Swagger/OpenAPI仕様書を作成
    - _要件: 全体_
  - [ ] 20.4 READMEとセットアップガイドの作成
    - プロジェクトのREADMEを作成
    - 開発環境セットアップガイドを作成
    - _要件: 全体_
